<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ ¡å›­å¢™ - å®Œæ•´ç‰ˆ</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:PingFang SC,Microsoft YaHei,sans-serif;transition:all 0.2s;}
:root{
  --bg:#f4f6f8; --card:#fff; --text:#222; --gray:#666; --light:#eee; --pri:#409eff;
}
.dark{
  --bg:#161616; --card:#242424; --text:#f0f0f0; --gray:#aaa; --light:#444; --pri:#409eff;
}
body{background:var(--bg);color:var(--text);padding:15px;}
.container{max-width:700px;margin:0 auto;}
.nav{
  background:var(--card);border-radius:16px;padding:14px 18px;
  display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;
}
.nav h1{font-size:20px;color:var(--pri);display:flex;align-items:center;gap:8px}
.avatar{width:32px;height:32px;border-radius:50%;object-fit:cover;}
.modeBtn{padding:8px 12px;border-radius:10px;background:var(--pri);color:#fff;border:none;cursor:pointer;}
.notice{
  background:var(--card);border-left:4px solid #ffba00;
  padding:12px 16px;border-radius:12px;margin-bottom:12px;font-size:14px;color:var(--gray);
}
.card{background:var(--card);border-radius:16px;padding:18px;margin-bottom:12px;box-shadow:0 3px 12px rgba(0,0,0,.05);}
input,textarea{
  width:100%;border:1px solid var(--light);background:var(--bg);color:var(--text);
  border-radius:12px;padding:14px;margin-top:10px;font-size:15px;
}
textarea{height:110px;resize:none;}
.btn{
  width:100%;background:var(--pri);color:#fff;border:none;
  border-radius:12px;padding:14px;margin-top:10px;font-size:15px;cursor:pointer;
}
.btn.small{padding:8px 12px;font-size:14px;width:auto;}
.btn.danger{background:#f56c6c;}
.btn.success{background:#67c23a;}
.btn.warn{background:#ff9800;}
.post-item{border-left:3px solid var(--pri);padding-left:14px;margin:18px 0;}
.post-content{margin:10px 0;line-height:1.7;font-size:15px;}
.post-img{max-width:100%;max-height:260px;border-radius:12px;margin:10px 0;object-fit:cover;}
.post-info{font-size:12px;color:var(--gray);display:flex;gap:14px;align-items:center;flex-wrap:wrap;}
.like{cursor:pointer;color:var(--gray);user-select:none;}
.comment{margin-top:14px;padding-top:14px;border-top:1px solid var(--light);}
.comment-item{font-size:13px;margin-top:8px;padding:8px 10px;background:var(--bg);border-radius:8px;}
.comment-input{margin-top:12px;display:flex;gap:10px;align-items:center;}
.comment-input input{margin-top:0;}
.login-box,.admin-box{display:none;}
#file{padding:6px;border:0;background:transparent;color:var(--text);}
.user-bar{
  display:flex;align-items:center;justify-content:space-between;
  padding:10px 14px;background:var(--card);border-radius:12px;margin-bottom:12px;
}
.tab{display:flex;gap:8px;margin-bottom:10px;}
.tab button{flex:1;padding:10px;border-radius:10px;border:none;background:var(--card);color:var(--text);cursor:pointer;}
.tab button.active{background:var(--pri);color:#fff;}
</style>
</head>
<body>
<div class="container">
  <div class="nav">
    <h1>ğŸ« æ ¡å›­å¢™</h1>
    <button class="modeBtn" onclick="toggleDark()">ğŸŒ™ æš—é»‘æ¨¡å¼</button>
  </div>

  <div id="noticeBox" class="notice">å…¬å‘Šï¼šåŠ è½½ä¸­...</div>

  <div id="loginBox" class="card login-box">
    <div class="tab">
      <button class="active" onclick="tab(1)">ç™»å½•</button>
      <button onclick="tab(2)">æ³¨å†Œ</button>
    </div>
    <div id="loginTab">
      <input id="login_user" placeholder="ç”¨æˆ·å">
      <input id="login_pwd" type="password" placeholder="å¯†ç ">
      <button class="btn" onclick="login()">ç™»å½•</button>
    </div>
    <div id="regTab" style="display:none">
      <input id="reg_user" placeholder="ç”¨æˆ·å">
      <input id="reg_pwd" type="password" placeholder="å¯†ç ">
      <input type="file" id="reg_avatar" accept="image/*">
      <button class="btn success" onclick="register()">æ³¨å†Œ</button>
    </div>
  </div>

  <div id="userBar" class="user-bar" style="display:none">
    <div style="display:flex;align-items:center;gap:8px">
      <img id="navAvatar" class="avatar" src="">
      <span id="navName"></span>
    </div>
    <button class="btn small" onclick="logout()">é€€å‡ºç™»å½•</button>
  </div>

  <div class="card" id="postBox" style="display:none;">
    <textarea id="content" placeholder="å†™ä¸‹ä½ æƒ³å‘å¸ƒçš„å†…å®¹..."></textarea>
    <input type="file" id="postImg" accept="image/*">
    <button class="btn" onclick="post()">æäº¤æŠ•ç¨¿</button>
  </div>

  <div class="card admin-box" id="adminPanel">
    <h3>âš™ï¸ ç®¡ç†åå°</h3>
    <input id="editNotice" placeholder="ä¿®æ”¹å…¬å‘Š">
    <button class="btn warn" onclick="saveNotice()">ä¿å­˜å…¬å‘Š</button>
    <h4 style="margin:10px 0">å¾…å®¡æ ¸</h4>
    <div id="waitList"></div>
  </div>

  <div id="postList"></div>
</div>

<script>
const ADMIN_PWD = "123456";
const DEFAULT_NOTICE = "æ¬¢è¿æ¥åˆ°æ ¡å›­å¢™ï¼æ–‡æ˜å‘è¨€ï¼Œç¦æ­¢è¿è§„å†…å®¹ï½";

function db(){
  return JSON.parse(localStorage.getItem("wall_full") || `{
    "users":[],"posts":[],"wait":[],"report":[],
    "notice":"${DEFAULT_NOTICE}"
  }`)
}
function save(d){localStorage.setItem("wall_full",JSON.stringify(d))}

let nowUser = null;
let userAvatar = "";

window.onload=()=>{
  if(localStorage.getItem("dark")==="true") document.body.classList.add("dark")
  loadNotice()
  checkLogin()
  renderPosts()
}

function tab(n){
  document.getElementById("loginTab").style.display = n===1?"block":"none"
  document.getElementById("regTab").style.display = n===2?"block":"none"
  document.querySelectorAll(".tab button").forEach((e,i)=>{
    e.classList.toggle("active",i+1===n)
  })
}

function toggleDark(){
  document.body.classList.toggle("dark")
  localStorage.setItem("dark",document.body.classList.contains("dark"))
}

function loadNotice(){
  document.getElementById("noticeBox").innerText = db().notice
}

function checkLogin(){
  const u = localStorage.getItem("nowUser")
  if(!u) {
    showVisitor()
    return
  }
  const d = db()
  const user = d.users.find(i=>i.user===u)
  if(!user) {
    logout()
    return
  }
  nowUser = u
  userAvatar = user.avatar || ""
  showUser()
}

function showVisitor(){
  document.getElementById("loginBox").style.display = "none"
  document.getElementById("userBar").style.display = "none"
  document.getElementById("postBox").style.display = "none"
}

function showUser(){
  document.getElementById("loginBox").style.display = "none"
  document.getElementById("userBar").style.display = "flex"
  document.getElementById("postBox").style.display = "block"
  document.getElementById("navName").innerText = nowUser
  document.getElementById("navAvatar").src = userAvatar || "https://picsum.photos/64/64"
}

function goLogin(){
  document.getElementById("loginBox").style.display = "block"
  document.getElementById("userBar").style.display = "none"
  document.getElementById("postBox").style.display = "none"
}

function getBase64(file){
  if(!file) return Promise.resolve("")
  return new Promise(r=>{
    const fr=new FileReader()
    fr.onload=e=>r(e.target.result)
    fr.readAsDataURL(file)
  })
}

async function register(){
  const user=document.getElementById("reg_user").value.trim()
  const pwd=document.getElementById("reg_pwd").value.trim()
  const avatar=await getBase64(document.getElementById("reg_avatar").files[0])
  if(!user||!pwd)return alert("è¯·å¡«å†™å®Œæ•´")
  const d=db()
  if(d.users.some(i=>i.user===user))return alert("ç”¨æˆ·åå·²å­˜åœ¨")
  d.users.push({user,pwd,avatar})
  save(d)
  alert("æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•")
  tab(1)
}

function login(){
  const user=document.getElementById("login_user").value.trim()
  const pwd=document.getElementById("login_pwd").value.trim()
  const d=db()
  const find=d.users.find(i=>i.user===user&&i.pwd===pwd)
  if(!find)return alert("è´¦å·æˆ–å¯†ç é”™è¯¯")
  localStorage.setItem("nowUser",user)
  location.reload()
}

function logout(){
  localStorage.removeItem("nowUser")
  location.reload()
}

async function post(){
  if(!nowUser)return alert("è¯·å…ˆç™»å½•")
  const content=document.getElementById("content").value.trim()
  const img=await getBase64(document.getElementById("postImg").files[0])
  if(!content&&!img)return alert("å†…å®¹ä¸èƒ½ä¸ºç©º")
  const d=db()
  d.wait.push({
    user:nowUser, avatar:userAvatar, content, img,
    time:new Date().toLocaleString(), like:0, cmt:[]
  })
  save(d)
  document.getElementById("content").value=""
  document.getElementById("postImg").value=""
  alert("æŠ•ç¨¿æˆåŠŸï¼ç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸")
  renderPosts()
}

function renderPosts(){
  const d=db()
  let html=""
  d.posts.forEach((it,i)=>{
    html+=`
    <div class="card post-item">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px">
        <img src="${it.avatar||'https://picsum.photos/64/64'}" class="avatar">
        <strong>${it.user}</strong>
      </div>
      <div class="post-content">${it.content}</div>
      ${it.img?`<img src="${it.img}" class="post-img">`:""}
      <div class="post-info">
        <span>${it.time}</span>
        <span class="like" onclick="like(${i})">ğŸ‘ ${it.like}</span>
        <button class="btn small warn" onclick="report(${i})">ä¸¾æŠ¥</button>
        <button class="btn small danger" onclick="adminDelPost(${i})">åˆ å¸–</button>
      </div>
      <div class="comment">
        ${it.cmt.map(c=>`<div class="comment-item">${c.user}ï¼š${c.text}</div>`).join("")}
        <div class="comment-input">
          <input placeholder="ç™»å½•åå¯è¯„è®º" id="cmt${i}" ${!nowUser?'disabled':''}>
          <button class="btn small" onclick="comment(${i})">å‘é€</button>
        </div>
      </div>
    </div>`
  })
  document.getElementById("postList").innerHTML=html

  let wait=""
  d.wait.forEach((it,i)=>{
    wait+=`
    <div class="post-item" style="padding:10px;border:1px solid var(--light);border-radius:12px">
      <div style="display:flex;align-items:center;gap:8px">
        <img src="${it.avatar||'https://picsum.photos/64/64'}" class="avatar">
        <strong>${it.user}</strong>
      </div>
      <div class="post-content">${it.content}</div>
      ${it.img?`<img src="${it.img}" class="post-img">`:""}
      <div class="post-info">${it.time}</div>
      <button class="btn small success" onclick="pass(${i})">é€šè¿‡</button>
      <button class="btn small danger" onclick="delWait(${i})">æ‹’ç»</button>
    </div>`
  })
  document.getElementById("waitList").innerHTML=wait
}

function like(i){
  if(!nowUser){
    alert("è¯·ç™»å½•åç‚¹èµ")
    goLogin()
    return
  }
  const d=db();d.posts[i].like++;save(d);renderPosts()
}

function comment(i){
  if(!nowUser){
    alert("è¯·ç™»å½•åè¯„è®º")
    goLogin()
    return
  }
  const t=document.getElementById(`cmt${i}`).value.trim()
  if(!t)return;const d=db();d.posts[i].cmt.push({user:nowUser,text:t})
  save(d);document.getElementById(`cmt${i}`).value="";renderPosts()
}

function report(i){
  if(!nowUser){
    alert("è¯·ç™»å½•åä¸¾æŠ¥")
    goLogin()
    return
  }
  alert("ä¸¾æŠ¥æˆåŠŸï¼ç®¡ç†å‘˜å°†å°½å¿«å¤„ç†")
}

function pass(i){const d=db();const item=d.wait.splice(i,1)[0];d.posts.unshift(item);save(d);renderPosts()}
function delWait(i){const d=db();d.wait.splice(i,1);save(d);renderPosts()}
function adminDelPost(i){const d=db();d.posts.splice(i,1);save(d);renderPosts()}
function saveNotice(){const d=db();d.notice=document.getElementById("editNotice").value;save(d);loadNotice();alert("å·²ä¿å­˜")}

window.admin=()=>{
  if(prompt("è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç ï¼š")===ADMIN_PWD){
    document.getElementById("adminPanel").style.display="block"
    alert("ç®¡ç†å‘˜å·²ç™»å½•")
  }
}
</script>
</body>
</html>
